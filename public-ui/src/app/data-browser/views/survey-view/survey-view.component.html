  <div class="survey-view">
    <div class="page-header">
      <div class="title-container" *ngIf="survey && survey.conceptId">
        <h1> {{survey.name}} </h1>
        <div class="desc-container">
          <p class="body-default help-text survey-desc">{{survey.description}} Survey questions appear in the order in which participants took the survey.</p>
        </div>
      </div>
      <div class="survey-note"> <span class="bold-note-heading">Note</span>: The data on this page are:
        <ul class="survey-note">
          <li>Gathered directly from participants through electronic surveys</li>
          <li>Grouped into bins of 20 to protect privacy</li>
        </ul>
        For more information about this survey, please visit the <a target="_blank" href="https://www.researchallofus.org/data-sources/survey-explorer" rel="noopener noreferrer">Survey Explorer</a>
      </div>
    </div>
    <div class="search-bar-container">
      <div id="db-search-bar">
        <clr-icon shape="search" class="is-info search-icon"></clr-icon>
        <input type="text" aria-label="Survey Search" id="search-db" placeholder="Keyword Search" [formControl]="searchText" style="height:auto" autofocus>
        <div *ngIf="searchText.value"  class="clear-icon" (click)="clearSearch()"><i class="far fa-times fa-1x clear-search-icon"></i></div>
      </div>
    </div>
    <app-spinner [loading]="loading"></app-spinner>
    <section *ngIf="questions.length > 0 && !loading" class="results">
      <a class="btn btn-link btn-sm link" [routerLink]="['']">
        < Back to main search </a> <div class="db-card">
      <div class="survey-head">
        <div class="stat-container">
          <h2 class="secondary-display">
            {{survey.participantCount | number }}
          </h2>
          <p class="info-text">
            Participants completed this survey
          </p>
        </div>
        <div class="stat-container">
          <h2 class="secondary-display">
            <span>{{ surveyResult.items.length }} </span>
          </h2>
          <p class="info-text">
            Questions displayed
          </p>
        </div>
        <div class="pdf-link" (click)="downloadPdf()">
          <a href="{{surveyPdfUrl}}" download>
            <clr-icon shape="file" class="has-badge is-solid"></clr-icon> Download Survey as PDF
          </a>
        </div>
      </div>
      <div class="survey-results" *ngIf="resultsComplete">
        <div class="question-result" *ngFor="let q of questions, let i = index">
          <div class="secondary-display">
            <div class="box-title"> Question {{q.actualQuestionNumber}}
              <clr-tooltip *ngIf="q.conceptId === 1586140" (mouseenter)="hoverOnTooltip(q, 'Race Ethnicity Question Help Text')">
                <clr-icon clrTooltipTrigger shape="info-standard" class="is-solid info-icon"></clr-icon>
                <clr-tooltip-content clrPosition=bottom-right clrSize="lg" *clrIfOpen>
                  <div class="tooltip-label">{{tooltipText.raceEthnicityQuestionHelpText1}} <i>{{tooltipText.allOfUsHelpText}}</i> {{tooltipText.raceEthnicityQuestionHelpText2}} <br/><br/>
                  {{tooltipText.raceEthnicityQuestionHelpText3}} </div>
                </clr-tooltip-content>
              </clr-tooltip>
              <clr-tooltip *ngIf="q.conceptId === 1585838" (mouseenter)="hoverOnTooltip(q, 'Race Ethnicity Question Help Text')">
                <clr-icon clrTooltipTrigger shape="info-standard" class="is-solid info-icon"></clr-icon>
                <clr-tooltip-content clrPosition=bottom-right clrSize="lg" *clrIfOpen>
                  <div class="tooltip-label">{{tooltipText.genderIdentityQuestionHelpText1}} <i>{{tooltipText.allOfUsHelpText}}</i> {{tooltipText.genderIdentityQuestionHelpText2}} <br/><br/>
                    {{tooltipText.genderIdentityQuestionHelpText3}} </div>
                </clr-tooltip-content>
              </clr-tooltip>
            </div>
            <div class="body-default" [ngClass]="{'active-question':showAnswer[q.conceptId]}">
              <app-highlight-search [text]="changeAutoInsertText(q)" [searchTerm]="searchText.value">
              </app-highlight-search>
            </div>
          </div>
          <div class="see-answers body-lead link" tabindex="0" (keydown.enter)="toggleAnswer(q)" (click)="toggleAnswer(q)"> See Answers
            <clr-icon *ngIf="!showAnswer[q.conceptId]" shape="caret" dir="right"></clr-icon>
            <clr-icon *ngIf="showAnswer[q.conceptId]" shape="caret" dir="down"></clr-icon>
          </div>
          <div class="survey-tbl" [hidden]="!showAnswer[q.conceptId]">
            <div class="survey-tbl-r survey-tbl-head">
              <div class="info-text first survey-tbl-d">
              </div>
              <div class="survey-tbl-r-group survey-tbl-r-group-style ">
                <div class="info-text survey-tbl-d display-body">
                  Concept Code
                  <clr-tooltip (mouseenter)="hoverOnTooltip(q, 'Concept Code')">
                    <clr-icon clrTooltipTrigger shape="info-standard" class="is-solid info-icon"></clr-icon>
                    <clr-tooltip-content clrPosition=bottom-left clrSize="lg" *clrIfOpen>
                      <div class="tooltip-label">{{tooltipText.conceptCodeHelpText1}} <i>{{tooltipText.allOfUsHelpText}}</i> {{tooltipText.conceptCodeHelpText2}} <i>{{tooltipText.allOfUsHelpText}}</i> {{tooltipText.conceptCodeHelpText3}}</div>
                    </clr-tooltip-content>
                  </clr-tooltip>
                </div>
                <div class=" info-text survey-tbl-d display-body">
                  Participant Count
                  <clr-tooltip *ngIf="multipleAnswerSurveyQuestions.indexOf(q.conceptId) > -1" (mouseenter)="hoverOnTooltip(q, 'Multiple Answers for this survey question help text')">
                    <clr-icon clrTooltipTrigger shape="info-standard" class="is-solid info-icon"></clr-icon>
                    <clr-tooltip-content clrPosition=bottom-left clrSize="lg" *clrIfOpen>
                      <div class="tooltip-label">{{tooltipText.surveyParticipantCountHelpText}}</div>
                    </clr-tooltip-content>
                  </clr-tooltip>
                </div>
                <div class=" info-text survey-tbl-d display-body">
                  % Answered
                </div>
                <div class="survey-tbl-d display-body"></div>
              </div>
            </div>
            <div [ngClass]="a.expanded?'survey-tbl-r-state':''" class="survey-tbl-exp-r "
                 *ngFor="let a of q.countAnalysis.surveyQuestionResults" (click)="showAnswerGraphs(a,q)"
                 [hidden]="!showAnswer[q.conceptId]">
              <div class="survey-tbl-r">
                <div class="survey-tbl-d first display-body info-text survey-answer-level-1" [ngClass]="{'active':a.expanded}">
                  <div>
                    <app-highlight-search [text]="a.stratum4" [searchTerm]="searchText.value">
                    </app-highlight-search>
                    <clr-tooltip *ngIf="q.conceptId === 1586140 && a.stratum3 === '903070'" (mouseenter)="hoverOnTooltip(q, 'Other category Help Text')">
                      <clr-icon clrTooltipTrigger shape="info-standard" class="is-solid info-icon"></clr-icon>
                      <clr-tooltip-content clrPosition=bottom-right clrSize="lg" *clrIfOpen>
                        <div class="tooltip-label">{{tooltipText.q2RolledCategoriesHelpText}}</div>
                      </clr-tooltip-content>
                    </clr-tooltip>
                  </div>
                </div>
                <div class="survey-tbl-r-group">
                  <div class="info-text survey-tbl-d display-body info-text">
                    <label class="concept-code">{{a.stratum3}}</label>
                  </div>

                  <div class="info-text survey-tbl-d display-body info-text">
                    <div class="participant-count" *ngIf="a.countValue <= 20; else Non20Counts;">
                      &le; {{a.countValue | number}}
                    </div>
                    <ng-template #Non20Counts>
                      <div class="body-lead info-text survey-tbl-d">
                        {{a.countValue | number}}
                      </div>
                    </ng-template>
                  </div>

                  <div class=" info-text survey-tbl-d display-body info-text">
                    <span>{{a.countPercent.toFixed(2)}}%</span>
                  </div>

                  <div class=" info-text survey-tbl-d display-body info-text display-body info-text graph-btn">
                    <button class="icon-btn" *ngIf="!a.subQuestions && a.stratum4 != 'Did not answer'">
                      <clr-icon [ngClass]="a.expanded?'is-solid':''" shape="bar-chart" style="height: 1.5rem; width: 1.5rem;color: #2691D0;"></clr-icon>
                    </button>
                    <button class="icon-btn" *ngIf="a.subQuestions">
                      <clr-icon *ngIf="!a.expanded" shape="caret" dir="right"></clr-icon>
                      <clr-icon *ngIf="a.expanded" shape="caret" dir="down"></clr-icon>
                    </button>
                  </div>
                </div>
              </div>

              <div class="survey-row-expansion" *ngIf="a.expanded && a.stratum4.toLowerCase() != 'did not answer' && !a.subQuestions" #chartElement>
                <app-survey-chart [graphButtons]="graphButtons" [subGraphButtons]="subGraphButtons" [question]="q" [selectedAnalysis]="q.selectedAnalysis" [selectedResult]="a" [surveyName]="survey.name"
                                  [searchTerm]="prevSearchText" [answer]="a"></app-survey-chart>
              </div>
              <div class="survey-row-expansion sub-table-1" *ngIf="a.expanded && a.subQuestions">
                <ng-container *ngFor="let subQuestion of a.subQuestions, let j = index">
                  <h6 class="sub-question-text">
                    <clr-icon shape="child-arrow" size="25"></clr-icon> <app-highlight-search [text]="changeAutoInsertText(subQuestion)" [searchTerm]="searchText.value">
                  </app-highlight-search>
                  </h6>
                  <div class="survey-tbl-r survey-sub-tbl-1">
                    <div class="survey-tbl-d first display-body info-text survey-question-heading">
                      ANSWER
                    </div>
                    <div class="survey-tbl-r-group">
                      <div class="survey-tbl-d display-body info-text survey-question-heading">
                        <label class="concept-code">Concept Code</label>
                      </div>

                      <div class="survey-tbl-d display-body info-text survey-question-heading">
                        <label class="participant-count">Participant Count</label>
                        <clr-tooltip *ngIf="multipleAnswerSurveyQuestions.indexOf(subQuestion.conceptId) > -1" (mouseenter)="hoverOnTooltip(q, 'Multiple Answers for this survey question help text')">
                          <clr-icon clrTooltipTrigger shape="info-standard" class="is-solid info-icon"></clr-icon>
                          <clr-tooltip-content clrPosition=bottom-left clrSize="lg" *clrIfOpen>
                            <div class="tooltip-label">{{tooltipText.surveyParticipantCountHelpText}}</div>
                          </clr-tooltip-content>
                        </clr-tooltip>
                      </div>

                      <div class="survey-tbl-d display-body info-text survey-question-heading">
                        <span>% Answered out of {{a.countValue}}</span>
                      </div>

                      <div class=" info-text survey-tbl-d display-body info-text display-body info-text graph-btn">

                      </div>
                    </div>
                  </div>
                  <div class="survey-tbl-exp-r survey-sub-tbl-1"
                       *ngFor="let sqa of subQuestion.countAnalysis.surveyQuestionResults" (click)="$event.stopPropagation();showSubAnswerGraphs(sqa, subQuestion)">
                    <div class="survey-tbl-r">
                      <div class="survey-tbl-d first display-body info-text sub-1-que survey-answer-level-1" [ngClass]="{'active':a.expanded && sqa.subExpanded}">
                        <div>
                          <app-highlight-search [text]="sqa.stratum4" [searchTerm]="searchText.value">
                          </app-highlight-search>
                        </div>
                      </div>
                      <div class="survey-tbl-r-group">
                        <div class="info-text survey-tbl-d display-body info-text">
                          <label class="concept-code">{{sqa.stratum3}}</label>
                        </div>

                        <div class="info-text survey-tbl-d display-body info-text">
                          <label class="participant-count" *ngIf="sqa.countValue <= 20; else Non20Counts;">
                            &le; {{sqa.countValue | number}}
                          </label>
                          <ng-template #Non20Counts>
                            <label class="body-lead info-text survey-tbl-d">
                              {{sqa.countValue | number}}
                            </label>
                          </ng-template>
                        </div>

                        <div class=" info-text survey-tbl-d display-body info-text">
                          <span>{{countPercentage(sqa.countValue, a.countValue).toFixed(2)}}%</span>
                        </div>

                        <div class=" info-text survey-tbl-d display-body info-text display-body info-text graph-btn">
                          <button class="icon-btn" *ngIf="!sqa.subQuestions && sqa.stratum4 != 'Did not answer'">
                            <clr-icon [ngClass]="sqa.subExpanded?'is-solid':''" shape="bar-chart" style="height: 1rem; width: 1rem;color: #2691D0;"></clr-icon>
                          </button>
                          <button class="icon-btn" *ngIf="sqa.subQuestions">
                            <clr-icon *ngIf="!sqa.subExpanded" shape="caret" dir="right"></clr-icon>
                            <clr-icon *ngIf="sqa.subExpanded" shape="caret" dir="down"></clr-icon>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="row-expansion" *ngIf="sqa.subExpanded && sqa.stratum4.toLowerCase() != 'did not answer' && !sqa.subQuestions">
                      <app-survey-chart [graphButtons]="graphButtons" [subGraphButtons]="subGraphButtons" [question]="subQuestion" [selectedAnalysis]="subQuestion.selectedAnalysis" [selectedResult]="sqa"
                                        [surveyName]="survey.name"
                                        [searchTerm]="prevSearchText" [answer]="sqa"></app-survey-chart>
                    </div>
                    <div class="row-expansion sub-table-2" *ngIf="sqa.subExpanded && sqa.subQuestions">
                      <ng-container *ngFor="let subQuestion2 of sqa.subQuestions">
                        <h6 class="sub-question-text" *ngIf="sqa.stratum4 !== subQuestion2.conceptName">
                          <clr-icon shape="child-arrow" size="25"></clr-icon> <app-highlight-search [text]="changeAutoInsertText(subQuestion2)" [searchTerm]="searchText.value">
                        </app-highlight-search>
                        </h6>
                        <div class="survey-tbl-r">
                          <div class="survey-tbl-d first display-body info-text survey-question-heading">
                            ANSWER
                          </div>
                          <div class="survey-tbl-r-group">
                            <div class="info-text survey-tbl-d display-body info-text survey-question-heading">
                              <label class="concept-code">Concept Code</label>
                            </div>

                            <div class="info-text survey-tbl-d display-body survey-question-heading">
                              <label class="participant-count">Participant Count</label>
                              <clr-tooltip *ngIf="multipleAnswerSurveyQuestions.indexOf(subQuestion2.conceptId) > -1" (mouseenter)="hoverOnTooltip(q, 'Multiple Answers for this survey question help text')">
                                <clr-icon clrTooltipTrigger shape="info-standard" class="is-solid info-icon"></clr-icon>
                                <clr-tooltip-content clrPosition=bottom-left clrSize="lg" *clrIfOpen>
                                  <div class="tooltip-label">{{tooltipText.surveyParticipantCountHelpText}}</div>
                                </clr-tooltip-content>
                              </clr-tooltip>
                            </div>

                            <div class=" info-text survey-tbl-d display-body survey-question-heading">
                              <span>% Answered out of {{sqa.countValue}}</span>
                            </div>

                            <div class=" info-text survey-tbl-d display-body info-text display-body info-text graph-btn">

                            </div>
                          </div>
                        </div>
                        <div class="survey-tbl-exp-r"
                             *ngFor="let sqa2 of subQuestion2.countAnalysis.surveyQuestionResults" (click)="$event.stopPropagation();showSubAnswerGraphs(sqa2, subQuestion2)">
                          <div class="survey-tbl-r">
                            <div class="survey-tbl-d first display-body info-text">
                              <div>
                                <app-highlight-search [text]="sqa2.stratum4" [searchTerm]="searchText.value">
                                </app-highlight-search>
                              </div>
                            </div>
                            <div class="survey-tbl-r-group">
                              <div class="info-text survey-tbl-d display-body info-text">
                                <label class="concept-code">{{sqa2.stratum3}}</label>
                              </div>

                              <div class="info-text survey-tbl-d display-body info-text">
                                <label class="participant-count">{{sqa2.countValue | number}} </label>
                              </div>

                              <div class=" info-text survey-tbl-d display-body info-text">
                                <span>{{countPercentage(sqa2.countValue, sqa.countValue).toFixed(2)}}%</span>
                              </div>

                              <div class=" info-text survey-tbl-d display-body info-text display-body info-text graph-btn">
                                <button class="icon-btn" *ngIf="!sqa2.subQuestions && sqa2.stratum4 != 'Did not answer'">
                                  <clr-icon [ngClass]="sqa2.subExpanded?'is-solid':''" shape="bar-chart" style="height: 1rem; width: 1rem;color: #2691D0;"></clr-icon>
                                </button>
                                <button class="icon-btn" *ngIf="sqa2.subQuestions">
                                  <clr-icon *ngIf="!sqa2.subExpanded" shape="caret" dir="right"></clr-icon>
                                  <clr-icon *ngIf="sqa2.subExpanded" shape="caret" dir="down"></clr-icon>
                                </button>
                              </div>
                            </div>
                          </div>
                          <div class="row-expansion" *ngIf="sqa2.subExpanded && sqa2.stratum4.toLowerCase() != 'did not answer' && !sqa2.subQuestions">
                            <app-survey-chart [graphButtons]="graphButtons" [subGraphButtons]="subGraphButtons" [question]="subQuestion2" [selectedAnalysis]="subQuestion2.selectedAnalysis" [selectedResult]="sqa2"
                                              [surveyName]="survey.name"
                                              [searchTerm]="prevSearchText"
                                              [answer]="sqa2"></app-survey-chart>
                          </div>
                        </div>
                      </ng-container>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </section>
  </div>
  <div class="no-results" *ngIf="questions.length === 0 && !loading && searchText.value">
    <p class="results-heading no-results">
      <span *ngIf="searchMethod === 'and'"> No questions match *ALL* keywords: <strong>
          {{searchText.value}}</strong>.
        <span class="search-extra"> <button class="btn btn-link" (click)="setSearchMethod('or')">Match any
            keyword</button> </span>
      </span>
      <span *ngIf="searchMethod === 'or'"> No questions match any of the keywords: <strong>
          {{searchText.value}}</strong>.
        <span class="search-extra"> <button class="btn btn-link" (click)="setSearchMethod('or', true)">Reset
            search</button></span>
      </span>
    </p>
    <p class="results-heading body-default" *ngIf="questions.length > 0 && !loading">
      <span *ngIf="searchMethod==='or'">
        <b> {{questions.length}} </b> questions match <b>*ANY*</b> keyword: <strong>{{searchText.value}}</strong>.
        <button class="btn btn-link" (click)="setSearchMethod('and')">Match all keywords</button>
      </span>
      <span *ngIf="searchMethod==='and'">
        <span> <b> {{questions.length}} </b> questions match <b>*ALL*</b> keywords:
          <strong>{{searchText.value}}</strong>.</span>
        <button class="btn btn-link" (click)="setSearchMethod('or')">Match any keyword</button>
      </span>
    </p>
    <app-db-no-results (newDomain)="changeResults($event)"[searchText]="searchText"></app-db-no-results>
  </div>